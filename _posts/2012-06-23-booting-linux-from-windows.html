---
layout: post
title: Установка Linux на компьютер с предустановленной Windows
commentIssueId: 3
---

<p>Сегодня многие компьютеры и ноутбуки попадают в руки поклонников Linux
с предустановленной Windows, любезно предоставленной
заводом-изготовителем. Возникает дилемма: удалять или не удалять, и
способ установки уже любимой OS зависит от её решения. Как правило,
изготовитель заранее побеспокоился о том, чтобы установка
дополнительной OS доставила вам множество незабываемых минут, часов,
дней и прочих радостей. Труден путь тех, кто не решился стереть все
воспоминания о Windows с диска, но дорогу осилит идущий.
</p>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Подготовка разделов диска</h3>
<div class="outline-text-3" id="text-1">


<p>
Способов установки дополнительной системы к Windows мало, поскольку
последняя поддерживает только таблицу разделов <a href="http://ru.wikipedia.org/wiki/Главная_загрузочная_запись">MBR</a>, возможности
которой ограничены 4 первичными разделами или 3 первичными и одним
расширенным. Как правило, три первичных раздела уже задействованы:
один &mdash; под восстановление системы, и ещё два &mdash; под Windows. Мы же
силами Linux LiveCD и редактора разделов Gparted подвинем полномочия
Windows, уменьшив его раздел, а на освободившемся пространстве
создадим расширенный (Extended) раздел под Linux. Предварительно,
полезно ознакомиться с тем, как правильно <a href="http://www.linux.org.ru/wiki/en/Выравнивание_разделов_диска">выравнивать разделы диска</a>.
Для Linux желательно создать не менее трёх логических разделов:
подкачки (swap), корневой и для домашнего каталога.
</p>
<p>
<a href="{{ site.cloud }}/images/gparted-partition-table.png"><img src="{{ site.cloud }}/images/gparted-partition-table.png" alt="" /></a>
</p>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Установка загрузчика</h3>
<div class="outline-text-3" id="text-2">


<p>
Можно было бы поместить загрузчик Grub на один из Windows-разделов,
если бы не неприкрытая любовь MicroSoft к NTFS. Для Grub эта файловая
система не подходит, поэтому установите Grub в корневой раздел Linux и
скопируйте файл настройки (<code>/boot/grub/grub.cfg</code> для Grub 2) в место,
доступное для Windows. BIOS будет передавать управление Windows, а уже
потом будет загружаться Grub. Однако, Windows не обладает способностью
грузить разделы с файловыми системами Linux. Нам нужен посредник, для
чего можно воспользоваться проектом <a href="https://gna.org/projects/grub4dos">Grub For DOS</a> или <a href="http://sourceforge.net/projects/grub24dos/">Grub 2 For DOS</a>.
Оба они равноправны, первый создан на основе Grub, второй &mdash; на
основе Grub 2. Об использовании Grub For DOS очень обстоятельно
рассказано <a href="http://ru.d-ws.biz/articles/install-ubuntu-from-flash-on-s205.shtml">здесь</a>, ну а для пользователей дистрибутивов на основе Grub
2 настоящей находкой является Grub 2 For DOS, о котором и пойдёт речь
дальше.
</p>
<p>
Установка Grub 2 For DOS очень проста: скачайте архив с сайта и
распакуйте в корень Windows-раздела (обычно, это диск <code>C</code>), там должна
появиться папка <code>grub</code>. Запустите <code>C:\grub\install\grub24dos.exe</code> и
выполните его настройку, после этого инсталлятор добавит новую запись
&laquo;Grub 2 For DOS&raquo; в меню загрузки Windows. Для наших целей достаточно
выставить &laquo;Windows boot timeout&raquo;, остальные данные продублируйте из
своего дистрибутива, поместив сохранённый <code>grub.cfg</code> в <code>C:\grub</code>.
Теперь выбор &laquo;Grub 2 For DOS&raquo; в меню загрузки перенесёт вас в
Grub 2.
</p>
<p>
<i>Прим. При любых изменениях, вносимых в конфигурацию Grub 2, не забывайте обновлять меню, подкладывая Grub 2 For DOS изменённый grub.cfg.</i>
</p>
</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">Ручная настройка BCD</h3>
<div class="outline-text-3" id="text-3">


<p>
Наверняка вам известно, что для загрузки, начиная с Windows Vista,
используется <a href="http://en.wikipedia.org/wiki/Windows_Vista_startup_process#Boot_Configuration_Data">Boot Configuration Data</a> (BCD), которую модифицирует Grub
2 For DOS. Для тонкой настройки меню загрузки предназначена
специальная утилита <b>bcdedit</b>. Желательно перед любыми изменениями
создавать резервную копию BCD в соответствии с <a href="http://sourcedaddy.com/windows-7/how-to-back-up-and-restore-settings.html">инструкцией</a>.
</p>
<p>
С помощью строки поиска в главном меню Windows найдите интерпретатор
командной строки <code>cmd</code> и выберите вариант запуска &laquo;Run as
administrator&raquo;. Используя подробную справку <code>bcdedit /v</code> по записям в
меню BCD, каждой из которых соответствует уникальный GIUD, найдите
&laquo;Grub 2 For DOS&raquo;. Можно выставить &laquo;Grub 2 For DOS&raquo; первым в меню
</p>


<pre class="src src-sh">bcdedit /displayorder {GUID} /addfirst
</pre>

<p>
и сделать его пунктом по умолчанию
</p>


<pre class="src src-sh">bcdedit /default {GUID}
</pre>


<p>
Дальнейшее описывает шаги по созданию записи &laquo;Grub 2 For DOS&raquo; с нуля
на тот случай, если вы пожелаете это сделать самостоятельно. Новая
запись в BCD создаётся командой
</p>


<pre class="src src-sh">bcdedit /create /d <span style="color: #bc8f8f;">"Grub 2 For Dos"</span> /application bootsector
</pre>

<p>
После этого будет отображен GUID новой записи, который нужно
подставлять в следующих командах. Укажем раздел, на котором находится
Grub 2 For DOS
</p>


<pre class="src src-sh">bcdedit /set {GUID} device <span style="color: #b8860b;">partition</span>=C:
</pre>

<p>
и местоположение загрузчика
</p>


<pre class="src src-sh">bcdedit /set {GUID} path \grub\winloader\grub.boot
</pre>

<p>
Новая запись в меню загрузки будет добавлена только после выполнения
команды
</p>


<pre class="src src-sh">bcdedit /displayorder {GUID} /addfirst
</pre>

<p>
Но желанию, можно заменить <code>/addfirst</code> на <code>/addlast</code>. Остаётся сделать эту запись выбором по умолчанию
</p>


<pre class="src src-sh">bcdedit /default {GUID}
</pre>

<p>
и установить время ожидания меню
</p>


<pre class="src src-sh">bcdedit /timeout 5
</pre>

</div>
</div>
